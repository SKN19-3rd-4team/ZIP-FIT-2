{% extends "base.html" %}
{% block title %}ê³µê³  ëª©ë¡ | ZIPFIT{% endblock %}
{% block nav_list %}bg-zip-light text-zip-primary3{% endblock %}

{% block content %}

<h2 class="text-2xl font-bold mb-6">ê³µê³  ëª©ë¡</h2>


<!-- ============================================================= -->
<!-- â–£ ì»¤ìŠ¤í…€ í•„í„° ë°” (ìœ í˜• / ì§€ì—­ / ìƒíƒœ / ê²€ìƒ‰) -->
<!-- ============================================================= -->

<form method="GET" id="filterForm" class="bg-white rounded-3xl p-6 shadow-soft mb-8">

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

        <!-- --------------------------------------------------------- -->
        <!-- â–£ 1) ìœ í˜• ë“œë¡­ë‹¤ìš´ (ì •ì  ë²„íŠ¼ ë‚˜ì—´) -->
        <!-- --------------------------------------------------------- -->
        <div class="relative">
            <button type="button"
                id="typeBtn"
                class="w-full border rounded-xl px-4 py-3 bg-white text-sm flex justify-between items-center">
                <span id="typeText">{{ request.GET.type|default:'ì „ì²´ ìœ í˜•' }}</span>
                â–¼
            </button>

            <div id="typeMenu"
                class="absolute hidden left-0 right-0 bg-white border rounded-xl shadow-lg mt-1 z-50 flex flex-col">

                <button type="button" class="dropdown-item px-4 py-2 text-sm hover:bg-gray-100"
                    data-value="">ì „ì²´ ìœ í˜•</button>

                <button type="button" class="dropdown-item px-4 py-2 text-sm hover:bg-gray-100"
                    data-value="ë¶„ì–‘">ë¶„ì–‘</button>

                <button type="button" class="dropdown-item px-4 py-2 text-sm hover:bg-gray-100"
                    data-value="ì„ëŒ€">ì„ëŒ€</button>

            </div>

            <input type="hidden" name="type" id="typeInput" value="{{ request.GET.type }}">
        </div>




        <!-- --------------------------------------------------------- -->
        <!-- â–£ 2) ì§€ì—­ ë“œë¡­ë‹¤ìš´ (ì •ì  ë²„íŠ¼ ë‚˜ì—´) -->
        <!-- --------------------------------------------------------- -->
        <div class="relative">
            <button type="button"
                id="regionBtn"
                class="w-full border rounded-xl px-4 py-3 bg-white text-sm flex justify-between items-center">
                <span id="regionText">{{ request.GET.region|default:'ì „ì²´ ì§€ì—­' }}</span>
                â–¼
            </button>

            <div id="regionMenu"
                class="absolute hidden left-0 right-0 bg-white border rounded-xl shadow-lg mt-1 z-50 max-h-60 overflow-y-auto flex flex-col">

                <!-- ì „ì²´ -->
                <button type="button" class="dropdown-item px-4 py-2 text-sm hover:bg-gray-100"
                    data-value="">ì „ì²´ ì§€ì—­</button>

                <!-- ê°œë³„ ì§€ì—­ ë²„íŠ¼ -->
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ê°•ì›íŠ¹ë³„ìì¹˜ë„">ê°•ì›íŠ¹ë³„ìì¹˜ë„</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ì „ë¶íŠ¹ë³„ìì¹˜ë„">ì „ë¶íŠ¹ë³„ìì¹˜ë„</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ê²½ê¸°ë„">ê²½ê¸°ë„</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</button>
                <button class="dropdown-item px-4 py-2 hover:bg-gray-100" data-value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</button>

            </div>

            <input type="hidden" name="region" id="regionInput" value="{{ request.GET.region }}">
        </div>




        <!-- --------------------------------------------------------- -->
        <!-- â–£ 3) ìƒíƒœ ë“œë¡­ë‹¤ìš´ (ì •ì  ë²„íŠ¼ ë‚˜ì—´) -->
        <!-- --------------------------------------------------------- -->
        <div class="relative">
            <button type="button"
                id="statusBtn"
                class="w-full border rounded-xl px-4 py-3 bg-white text-sm flex justify-between items-center">
                <span id="statusText">{{ request.GET.status|default:'ì „ì²´ ìƒíƒœ' }}</span>
                â–¼
            </button>

            <div id="statusMenu"
                class="absolute hidden left-0 right-0 bg-white border rounded-xl shadow-lg mt-1 z-50 flex flex-col">

                <button type="button" class="dropdown-item px-4 py-2 text-sm hover:bg-gray-100"
                    data-value="">ì „ì²´ ìƒíƒœ</button>

                <button type="button" class="dropdown-item px-4 py-2 hover:bg-gray-100"
                    data-value="ê³µê³ ì¤‘">ê³µê³ ì¤‘</button>

                <button type="button" class="dropdown-item px-4 py-2 hover:bg-gray-100"
                    data-value="ì •ì •ê³µê³ ì¤‘">ì •ì •ê³µê³ ì¤‘</button>

                <button type="button" class="dropdown-item px-4 py-2 hover:bg-gray-100"
                    data-value="ì ‘ìˆ˜ì¤‘">ì ‘ìˆ˜ì¤‘</button>

                <button type="button" class="dropdown-item px-4 py-2 hover:bg-gray-100"
                    data-value="ì ‘ìˆ˜ë§ˆê°">ì ‘ìˆ˜ë§ˆê°</button>

            </div>

            <input type="hidden" name="status" id="statusInput" value="{{ request.GET.status }}">
        </div>




        <!-- --------------------------------------------------------- -->
        <!-- â–£ 4) ê²€ìƒ‰ì°½ -->
        <!-- --------------------------------------------------------- -->
        <div class="flex">
            <input type="text" name="q"
                value="{{ request.GET.q|default:'' }}"
                placeholder="ê³µê³ ëª… ë˜ëŠ” í‚¤ì›Œë“œ ê²€ìƒ‰"
                class="flex-1 border rounded-l-xl px-4 py-3 text-sm focus:ring-zip-primary focus:border-zip-primary">

            <button class="bg-zip-primary text-white px-6 rounded-r-xl hover:bg-zip-primary3 transition">
                ê²€ìƒ‰
            </button>
        </div>

    </div>
</form>


<!-- ============================================================= -->
<!-- â–£ ê³µê³  ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ (3ì—´) -->
<!-- ============================================================= -->

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

    {% for item in page_obj %}
    <div class="bg-white rounded-3xl p-6 shadow-soft hover:shadow-lg transition">

        <!-- ìƒë‹¨ : ì¹´í…Œê³ ë¦¬ + ì¦ê²¨ì°¾ê¸° -->
        <div class="flex justify-between items-center">
            <span class="text-xs px-3 py-1 rounded-full bg-zip-light text-zip-primary3">
                {{ item.category }}
            </span>

            <!-- â­ ì¦ê²¨ì°¾ê¸° -->
            <button
                class="favorite-btn text-xl transition transform"
                data-id="{{ item.id }}"
                data-title="{{ item.title }}"
                style="color: {% if item.id in favorite_ids %}#fbbf24{% else %}#d1d5db{% endif %};">
                â­
            </button>
        </div>


        <!-- ì œëª© -->
        <div class="flex justify-between items-start mt-3">
            <h3 class="text-lg font-bold">{{ item.title }}</h3>

            <!-- ìƒíƒœ ë°°ì§€(ì˜¤ë¥¸ìª½ ì •ë ¬) -->
            <span class="text-xs px-2 py-1 rounded-full ml-3 whitespace-nowrap
                {% if item.status == 'ê³µê³ ì¤‘' %} bg-green-100 text-green-600
                {% elif item.status == 'ì •ì •ê³µê³ ì¤‘' %} bg-purple-100 text-purple-600
                {% elif item.status == 'ì ‘ìˆ˜ì¤‘' %} bg-blue-100 text-blue-600
                {% elif item.status == 'ì ‘ìˆ˜ë§ˆê°' %} bg-gray-200 text-gray-500
                {% endif %}
            ">
                {{ item.status }}
            </span>
        </div>


        <!-- ë‚ ì§œ + ì§€ì—­ (institution ì œê±°ë¨) -->
        <p class="text-sm text-gray-500 mt-2">
            ğŸ“… {{ item.date_range }} Â· ğŸ“ {{ item.region }}
        </p>

        <!-- ìš”ì•½ -->
        <p class="text-sm text-gray-600 mt-3">{{ item.summary }}</p>

        <a href="{{ item.detail_url }}"
           class="inline-block mt-4 text-sm text-zip-primary3 font-semibold hover:underline">
           ìì„¸íˆ ë³´ê¸° â†’
        </a>
    </div>
    {% empty %}
    <p class="text-gray-500 text-center py-10">ê²€ìƒ‰ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endfor %}

</div>



<!-- ============================================================= -->
<!-- â–£ í˜ì´ì§€ë„¤ì´ì…˜ -->
<!-- ============================================================= -->
{% if total > 1 %}
<div class="flex justify-center mt-12 gap-2 text-sm">

    {% if current > 1 %}
    <a href="?page=1" class="px-3 py-2 border rounded-lg hover:bg-gray-100">Â« ì²˜ìŒ</a>
    {% endif %}

    {% if group_start > 1 %}
    <a href="?page={{ group_start|add:'-1' }}" class="px-3 py-2 border rounded-lg hover:bg-gray-100">â€¹ ì´ì „</a>
    {% endif %}

    {% for n in page_numbers %}
    <a href="?page={{ n }}"
       class="px-3 py-2 border rounded-lg {% if n == current %}bg-zip-primary text-white{% endif %}">
        {{ n }}
    </a>
    {% endfor %}

    {% if group_end < total %}
    <a href="?page={{ group_end|add:'1' }}" class="px-3 py-2 border rounded-lg hover:bg-gray-100">ë‹¤ìŒ â€º</a>
    {% endif %}

    {% if current < total %}
    <a href="?page={{ total }}" class="px-3 py-2 border rounded-lg hover:bg-gray-100">ë Â»</a>
    {% endif %}

</div>
{% endif %}


<!-- ============================================================= -->
<!-- â–£ JS â€” ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ + ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥ -->
<!-- ============================================================= -->

<script>
document.addEventListener("DOMContentLoaded", () => {

    /* -----------------------------
       ëª¨ë“  ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ê³µí†µ ì œì–´
    ----------------------------- */
    function setupDropdown(btnId, menuId, textId, inputId) {

        const btn = document.getElementById(btnId);
        const menu = document.getElementById(menuId);
        const text = document.getElementById(textId);
        const input = document.getElementById(inputId);

        // ë“œë¡­ë‹¤ìš´ ì—´ê¸°/ë‹«ê¸°
        btn.addEventListener("click", () => {
            menu.classList.toggle("hidden");
        });

        // ì˜µì…˜ ì„ íƒ ì‹œ
        menu.querySelectorAll(".dropdown-item").forEach(item => {
            item.addEventListener("click", () => {
                const raw = item.dataset.value;
                const value = raw.includes("ì „ì²´") ? "" : raw;
                text.textContent = raw;
                input.value = value;

                menu.classList.add("hidden");

                // ìë™ submit
                btn.closest("form").submit();
            });
        });

        // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener("click", e => {
            if (!btn.contains(e.target) && !menu.contains(e.target)) {
                menu.classList.add("hidden");
            }
        });
    }

    setupDropdown("typeBtn", "typeMenu", "typeText", "typeInput");
    setupDropdown("regionBtn", "regionMenu", "regionText", "regionInput");
    setupDropdown("statusBtn", "statusMenu", "statusText", "statusInput");


    /* -----------------------------
       ì¦ê²¨ì°¾ê¸° ë²„íŠ¼
    ----------------------------- */
    document.querySelectorAll(".favorite-btn").forEach(btn => {
        btn.addEventListener("click", () => {

            const isActive = btn.style.color === "rgb(251, 191, 36)"; // yellow-400
            const url = isActive ? "/web/favorite/remove/" : "/web/favorite/add/";

            fetch(url, {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify({
                    id: btn.dataset.id,
                    title: btn.dataset.title
                })
            });

            // âœ¨ toggle color
            btn.style.color = isActive ? "#d1d5db" : "#fbbf24";

            // scale animation
            btn.classList.add("scale-125");
            setTimeout(() => btn.classList.remove("scale-125"), 150);
        });
    });

});
</script>

{% endblock %}










