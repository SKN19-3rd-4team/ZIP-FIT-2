{% extends "base.html" %}
{% block title %}AI ìƒë‹´ | ZIPFIT{% endblock %}
{% block nav_chat %}bg-zip.card{% endblock %}

{% block content %}

<div class="max-w-3xl mx-auto space-y-5">

    <!-- Header -->
    <h2 class="text-xl font-bold mb-4">AI ìƒë‹´</h2>

    <!-- Chat Window -->
    <div id="chat-box" class="bg-white rounded-3xl p-6 shadow-soft h-[600px] overflow-y-auto space-y-4">

        <!-- Example AI Message -->
        <div class="flex items-start gap-3">
            <div class="w-8 h-8 bg-zip.card rounded-xl flex items-center justify-center">ğŸ¤–</div>
            <div class="max-w-[70%] bg-gray-100 px-4 py-2 rounded-2xl">
                ì•ˆë…•í•˜ì„¸ìš”! ê³µê³µì£¼íƒ ì „ë¬¸ AIì…ë‹ˆë‹¤ ğŸ˜Š<br>   
                ê¶ê¸ˆí•˜ì‹  ì ì„ ììœ ë¡­ê²Œ ë¬¼ì–´ë³´ì„¸ìš” ğŸ˜†
            </div>
        </div>

        <!-- User Example Message -->
        <div class="flex justify-end">
            <div class="max-w-[70%] bg-zip-primary text-white px-4 py-2 rounded-2xl">
                ê²½ê¸°ë„ ì‹ í˜¼ë¶€ë¶€ ê³µê³  ì•Œë ¤ì¤˜
            </div>
        </div>

    </div>

    <!-- Input Box -->
    <div class="flex gap-3">
        <input id="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”â€¦" class="flex-1 border rounded-xl px-4 py-3">
        <button id="send-btn" class="bg-zip-primary text-white px-6 rounded-xl hover:bg-zip-primary3 transition">ì „ì†¡</button>
    </div>
</div>

<script>
    const box = document.getElementById("chat-box");
    const input = document.getElementById("chat-input");
    const btn = document.getElementById("send-btn");

    btn.onclick = async () => {
        const text = input.value.trim();
        if (!text) return;

        // User bubble
        box.innerHTML += `
            <div class="flex justify-end">
                <div class="max-w-[70%] bg-zip-primary text-white px-4 py-2 rounded-2xl">${text}</div>
            </div>
        `;
        box.scrollTop = box.scrollHeight;

        // Call backend API
        const res = await fetch("/web/ask/", {
            method: "POST",
            body: JSON.stringify({ query: text }),
            headers: { "Content-Type": "application/json" }
        }).then(r => r.json());

        // AI bubble
        box.innerHTML += `
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 bg-zip.card rounded-xl flex items-center justify-center">ğŸ¤–</div>
                <div class="max-w-[70%] bg-gray-100 px-4 py-2 rounded-2xl">${res.answer}</div>
            </div>
        `;
        box.scrollTop = box.scrollHeight;

        input.value = "";
    };
</script>

{% endblock %}

