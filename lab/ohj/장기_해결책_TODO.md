# 장기 해결책 TODO 리스트

## 목적
접수 시작일 정보를 정확하게 추출하여 동적 상태 표시의 정확도를 높이기 위한 장기 개선 사항

## 현재 상황

### 문제점
- `annc_pblsh_dt`는 "게시일"이지 "접수 시작일"이 아님
- 공고2 예시: 게시일 2025.05.28, 접수 시작일 2025.06.19 (약 3주 차이)
- 접수 시작일 정보가 없어서 정확한 상태 판단 불가

### 현재 해결책 (단기)
- 프론트엔드에서 `annc_pblsh_dt`를 접수 시작일로 가정하여 동적 상태 계산
- 접수기간 내에 있으면 "접수중"으로 표시
- **정확도 낮음**: 게시일과 접수 시작일이 다를 수 있음

### 크롤러 현황
- 현재 크롤러는 목록 페이지에서만 데이터 추출
- 상세 페이지 접근 안 함 (리소스 절감을 위해 URL만 저장)
- 상세 페이지에서 접수 시작일 정보 추출 가능할 것으로 예상

## 장기 해결책 작업 항목

### 1. 모델 필드 추가 ⏳
**우선순위**: 높음  
**예상 소요 시간**: 1-2시간

**작업 내용**:
- `AnncAll` 모델에 `annc_recruitment_start_dt` 필드 추가
- `null=True, blank=True`로 설정 (기존 데이터 호환성)

**파일**: `zf_django/chatbot/models.py`

```python
annc_recruitment_start_dt = models.CharField(
    max_length=50, 
    verbose_name="접수 시작일", 
    null=True, 
    blank=True
)
```

**체크리스트**:
- [ ] 모델 필드 추가
- [ ] 마이그레이션 파일 생성 (`python manage.py makemigrations`)
- [ ] 마이그레이션 실행 (`python manage.py migrate`)
- [ ] 기존 데이터 확인 (null 값 허용)

---

### 2. 크롤러 수정 - 상세 페이지 접근 ⏳
**우선순위**: 높음  
**예상 소요 시간**: 3-4시간

**작업 내용**:
- 공고 상세 페이지 크롤링 로직 추가
- 접수 시작일 정보 추출
- `annc_recruitment_start_dt` 필드에 저장

**파일**: `zf_crawler/src/crawler/lh.py`

**구현 방안**:
1. 공고 상세 페이지 HTML 파싱
2. 접수 시작일 정보 추출 (표 또는 텍스트에서)
3. 날짜 형식 정규화 및 저장

**주의사항**:
- 리소스 사용량 증가 (각 공고마다 상세 페이지 접근)
- 크롤링 시간 증가
- 서버 부하 고려 필요

**체크리스트**:
- [ ] 상세 페이지 크롤링 함수 추가
- [ ] 접수 시작일 추출 로직 구현
- [ ] 날짜 형식 정규화 로직 추가
- [ ] 에러 처리 및 로깅 추가
- [ ] 테스트 (소량 데이터로)

---

### 3. 크롤러 수정 - 데이터 저장 ⏳
**우선순위**: 높음  
**예상 소요 시간**: 1시간

**작업 내용**:
- 크롤러에서 추출한 접수 시작일을 DB에 저장
- Repository 레이어 수정

**파일**: 
- `zf_crawler/src/database/repository/annc_lh_repo.py`
- `zf_crawler/src/database/repository/annc_all_repo.py`

**체크리스트**:
- [ ] Repository에 접수 시작일 필드 추가
- [ ] INSERT/UPDATE 쿼리 수정
- [ ] 기존 데이터와의 호환성 확인

---

### 4. API 응답 수정 ⏳
**우선순위**: 중간  
**예상 소요 시간**: 30분

**작업 내용**:
- API 응답에 `annc_recruitment_start_dt` 필드 추가

**파일**: `zf_django/chatbot/views.py`

**체크리스트**:
- [ ] `annc_list` 함수에서 `annc_recruitment_start_dt` 필드 추가
- [ ] API 문서 업데이트 (drf_spectacular)

---

### 5. 프론트엔드 수정 ⏳
**우선순위**: 중간  
**예상 소요 시간**: 1-2시간

**작업 내용**:
- `annc_recruitment_start_dt` 필드를 우선 사용
- 없으면 `annc_pblsh_dt` 사용 (하위 호환성)

**파일**: `zf_django/web/templates/web/list.html`

**수정 함수**:
- `getCurrentStatus()`: 접수 시작일 필드 우선 사용
- `getRecruitmentPeriod()`: 접수 시작일 필드 우선 사용
- `getDDay()`: 접수 시작일 필드 우선 사용

**체크리스트**:
- [ ] `getCurrentStatus` 함수 수정
- [ ] `getRecruitmentPeriod` 함수 수정
- [ ] `getDDay` 함수 수정
- [ ] 하위 호환성 확인 (기존 데이터)
- [ ] 테스트 (새 데이터, 기존 데이터)

---

### 6. 테스트 및 검증 ⏳
**우선순위**: 높음  
**예상 소요 시간**: 2-3시간

**작업 내용**:
- 전체 플로우 테스트
- 데이터 정확도 검증

**체크리스트**:
- [ ] 크롤러 테스트 (소량 데이터)
- [ ] DB 저장 확인
- [ ] API 응답 확인
- [ ] 프론트엔드 표시 확인
- [ ] 다양한 공고 유형 테스트
- [ ] 기존 데이터와의 호환성 테스트

---

## 작업 순서

### Phase 1: 백엔드 준비
1. 모델 필드 추가
2. 마이그레이션 실행
3. API 응답 수정

### Phase 2: 크롤러 수정
1. 상세 페이지 크롤링 로직 추가
2. 접수 시작일 추출 로직 구현
3. 데이터 저장 로직 수정

### Phase 3: 프론트엔드 수정
1. 접수 시작일 필드 우선 사용
2. 하위 호환성 확인

### Phase 4: 테스트 및 검증
1. 전체 플로우 테스트
2. 데이터 정확도 검증

## 예상 일정

- **Phase 1**: 2-3시간
- **Phase 2**: 4-5시간 (가장 복잡)
- **Phase 3**: 1-2시간
- **Phase 4**: 2-3시간

**총 예상 소요 시간**: 9-13시간

## 리스크 및 고려사항

### 리스크
1. **크롤링 시간 증가**: 상세 페이지 접근으로 인한 시간 증가
2. **서버 부하**: LH 웹사이트 서버 부하 가능성
3. **HTML 구조 변경**: LH 웹사이트 구조 변경 시 크롤러 수정 필요
4. **데이터 불일치**: 일부 공고는 접수 시작일 정보가 없을 수 있음

### 대응 방안
1. 크롤링 시간 증가는 필수 비용으로 수용
2. 요청 간 딜레이 추가로 서버 부하 완화
3. 에러 처리 및 로깅 강화
4. 접수 시작일이 없으면 `annc_pblsh_dt` 사용 (하위 호환성)

## 참고 문서

- `lab/ohj/DB_필드_분석_및_해결방안.md`: 상세 분석 내용
- `lab/ohj/크롤러_접수시작일_확인_결과.md`: 크롤러 코드 분석 결과
- `lab/ohj/Git_병합_및_크롤러_업데이트_가이드.md`: Git 병합 가이드

## 진행 상황 추적

- [ ] Phase 1 완료
- [ ] Phase 2 완료
- [ ] Phase 3 완료
- [ ] Phase 4 완료
- [ ] 프로덕션 배포

## 업데이트 이력

- 2025-12-11: TODO 리스트 생성
- 향후 각 Phase 완료 시 업데이트 예정

