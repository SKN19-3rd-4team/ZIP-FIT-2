# 추가 문제 해결 요약

## 해결된 문제

### 1. 공고 상태 및 모집 기간 표시 문제 ✅
**문제**: 
- 실제 API 데이터에서 공고 상태가 "공고중"인데 "공고예정"으로 표시됨
- 모집 기간이 잘못 표시됨 (실제: 2025.12.15 ~ 2025.12.19, 표시: 2025.12.12 ~ 2025.12.25)
- D-day가 표시되지 않음

**원인**: 
- `getRecruitmentPeriod`, `getDDay`, `getCurrentStatus` 함수가 실제 API 데이터의 `annc_pblsh_dt`(게시일)와 `annc_deadline_dt`(마감일) 필드를 사용하지 않음
- `created_dttm`을 기반으로 계산하여 잘못된 결과 도출

**해결**:
- `zf_django/chatbot/views.py`의 `annc_list` 함수에서 `annc_pblsh_dt`와 `annc_deadline_dt` 필드를 응답에 추가
- `getRecruitmentPeriod` 함수: `annc_pblsh_dt`와 `annc_deadline_dt`를 우선 사용하도록 수정
- `getDDay` 함수: `annc_deadline_dt`를 우선 사용하도록 수정
- `getCurrentStatus` 함수: 날짜 기반으로 상태를 재확인하도록 수정 (공고일이 미래면 공고예정, 마감일이 지났으면 마감)

**변경 파일**:
- `zf_django/chatbot/views.py`: `annc_list` 함수에 날짜 필드 추가
- `zf_django/web/templates/web/list.html`: 날짜 기반 계산 로직 수정

### 2. 로딩 메시지 표시 문제 ✅
**문제**: API 호출 시 로딩 메시지가 표시되지 않고 결과만 바로 출력됨

**원인**: 
- API 응답이 너무 빨리 오면 로딩 메시지가 보이지 않음
- 최소 로딩 시간이 보장되지 않음

**해결**:
- `chat.html`의 `askQuestion` 함수와 채팅 폼 제출 핸들러에 최소 로딩 시간(300ms) 보장 로직 추가
- `Promise.all`을 사용하여 API 호출과 최소 로딩 시간을 동시에 처리

**변경 파일**:
- `zf_django/web/templates/web/chat.html`: 최소 로딩 시간 보장 로직 추가

### 3. 필터 문제 (진행 중) ⚠️
**문제**: API 호출 모드에서 필터(기관, 유형, 상태)가 올바르지 않게 작동함

**원인**: 
- `annc_list` 함수에서 필터링 로직은 구현되어 있으나, 프론트엔드에서 필터 파라미터가 제대로 전달되지 않을 수 있음
- 또는 필터 조건이 DB 데이터와 일치하지 않을 수 있음

**확인 필요**:
- `list.html`의 `loadAnnouncements` 함수에서 필터 파라미터가 올바르게 전달되는지 확인
- API 응답에서 필터링이 제대로 적용되는지 확인
- DB의 `annc_status`, `annc_type` 값이 프론트엔드 필터 값과 일치하는지 확인

## 테스트 체크리스트

- [x] 실제 API 데이터에서 공고 상태가 올바르게 표시되는지 확인
- [x] 모집 기간이 `annc_pblsh_dt`와 `annc_deadline_dt`를 기반으로 올바르게 표시되는지 확인
- [o] D-day가 올바르게 계산되어 표시되는지 확인

    위 3가지 사항에 대해서 체크한 사항

    -> [정정공고]양주회천 A25BL 영구임대주택 입주자 모집공고 -> 여전히 '공고 예정'으로 나옴
    공고 에정이 맞나? 공고중 인 것 같은데?
    -> 실제 공고 웹페이지 데이터
        양주시, 동두천시 행복주택 상시모집[선착순동호지정, 입주자격완화, 선계약후검증]
        공고상태: 공고중
        유형: 행복주택
        공고일: 2025.05.28
        접수기간 : 2025.06.19 ~ 2025.12.31

    -> 우리 웹페이지 데이터
        양주시, 동두천시 행복주택 상시모집[선착순동호지정, 입주자격완화, 선계약후검증]
        태그: LH 행복주택 공고예정
        모집 기간 2025.05.28 ~ 2025.12.31 D-20

    실제 웹페이지 데이터, API로 호출 받은 정보, 웹페이지 정보 일치하는지 확인 바람.

- [o] 채팅 API 호출 시 로딩 메시지가 최소 300ms 동안 표시되는지 확인
- [o] 공고 카드에서 "AI 상담하기" 클릭 시 로딩 메시지가 표시되는지 확인
- [x] API 호출 모드에서 필터가 정상 작동하는지 확인 (추가 디버깅 필요)

    -> 확인사항 공유
    기관 필터 안됨, 현재 공고는 아래와 같다. 카드 2개(현재)
    ```
    LH 영구임대주택
    공고예정
    [정정공고]양주회천 A25BL 영구임대주택 입주자 모집공고
    모집 기간
    2025.12.02 ~ 2025.12.19 D-8

    LH 행복주택
    공고예정
    양주시, 동두천시 행복주택 상시모집[선착순동호지정, 입주자격완화, 선계약후검증]
    모집 기간
    2025.05.28 ~ 2025.12.31 D-20
    ```
    -> 문제 공유
    - 기관 LH, GH, SH 선택해도 위 공고들이 그대로 보임. LH에서만 보여야함.
    - 공고중으로 필터링하면 위 공고 카드가 보임 -> 우선 현재 태그상으로는 '공고예정'으로 웹페이지에서 나오는데, 공고중으로 필터링시 나옴.
    - 접수중, 마감, 공고예정 -> 공고가 없습니다.
    - 영구임대주택 -> 양주회천 A25BL 영구임대주택 입주자 모집공고 만 필터링 되어야함 -> 공고가 없습니다.
    - 행복주택 -> 마찬가지로 공고가 없습니다.라고 나옴. -> 필터링 되지 않음.



## 추가 확인 사항

### 날짜 형식 파싱
- `annc_pblsh_dt`와 `annc_deadline_dt`의 실제 형식 확인 필요
- 현재 코드는 "2025.12.15", "2025-12-15" 형식을 지원하지만, 다른 형식이 있을 수 있음
- 필요시 날짜 파싱 로직 추가 수정

### 필터 디버깅
- 브라우저 개발자 도구의 Network 탭에서 실제 API 요청 파라미터 확인 -> 우리가 기존에 가지고 있는 API 구조 파악한 것에서 정보를 확인할 수 있을까? @lab\ohj\API_구조_분석.md
- 서버 로그에서 필터링 쿼리 확인 -> mockData 에서는 테스트 완료해서 문제 없었는데 왜 api호출 데이터에서는 문제가 생기는가?
- DB의 실제 데이터 값 확인 -> 확인해보면 좋겠다.

## 추가 문제
- api 호출 모드 : user-info 에서 부여하는 사용자 자동 ID가 바뀌지 않음. 하나로 고정되어있음.

