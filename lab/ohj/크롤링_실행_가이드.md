# 크롤링 실행 및 데이터 확인 가이드

> **PostgreSQL에 실제 공고 데이터 입력 후 API 테스트 진행**

---

## 📋 작업 순서

### 1단계: 크롤링 실행
### 2단계: 데이터 확인
### 3단계: API 테스트
### 4단계: 프론트엔드 개발

---

## 1단계: 크롤링 실행

### 전제 조건 확인

**필수 확인 사항**:
- [ ] Docker 컨테이너 실행 중 (`zf_db_container`)
- [ ] PostgreSQL 연결 가능
- [ ] Conda 가상환경 활성화 (`zipfit_env` 또는 `zf2_back`)
- [ ] 필요한 패키지 설치 완료

### 크롤링 노트북 실행

**파일 위치**: `zf_crawler/크롤링.ipynb`

**실행 순서**:
1. Jupyter Notebook 실행
   ```bash
   # Conda 환경 활성화
   conda activate zipfit_env  # 또는 zf2_back
   
   # Jupyter Notebook 실행
   jupyter notebook
   ```

2. `zf_crawler/크롤링.ipynb` 파일 열기

3. 노트북 셀 순서대로 실행
   - 환경 변수 로드
   - 테이블 존재 여부 확인
   - 크롤링 실행
   - 데이터 중복 제거
   - DB INSERT
   - 파일 등록 및 처리

**주의 사항**:
- 노트북의 설정 변수 확인:
  ```python
  CRWALING = True         # 크롤링 실행 여부
  DB_BULK_INSERT = True   # DB INSERT 실행 여부
  TEST_SIZE = 1           # 테스트용 크기 (전체 실행 시 -1)
  ```

---

## 2단계: 데이터 확인

### PostgreSQL에서 데이터 확인

**방법 1: DBeaver 사용**
1. DBeaver에서 PostgreSQL 연결
2. `zf_db` 데이터베이스 선택
3. 다음 쿼리 실행:

```sql
-- 공고 전체 개수 확인
SELECT COUNT(*) FROM annc_all;

-- 공고 목록 확인 (최신순)
SELECT 
    annc_id,
    annc_title,
    annc_status,
    annc_type,
    annc_region,
    created_dttm
FROM annc_all
ORDER BY created_dttm DESC
LIMIT 10;

-- 공고 상태별 개수
SELECT annc_status, COUNT(*) as cnt
FROM annc_all
GROUP BY annc_status;

-- 공고 타입별 개수
SELECT annc_type, COUNT(*) as cnt
FROM annc_all
GROUP BY annc_type;
```

**방법 2: Docker 명령어 사용**
```bash
# Docker 컨테이너 접속
docker exec -it zf_db_container psql -U zf_admin -d zf_db

# 공고 개수 확인
SELECT COUNT(*) FROM annc_all;

# 공고 목록 확인
SELECT annc_id, annc_title, annc_status, annc_type 
FROM annc_all 
ORDER BY created_dttm DESC 
LIMIT 10;
```

### Django 관리자에서 확인

**방법 3: Django Admin 사용**
1. Django 서버 실행:
   ```bash
   cd zf_django
   python manage.py runserver
   ```

2. 브라우저에서 접속:
   - `http://127.0.0.1:8000/admin`
   - 관리자 계정으로 로그인
   - `Chatbot` → `Annc alls` 메뉴 확인

---

## 3단계: API 테스트

### 데이터 확인 후 API 테스트

**확인 사항**:
- [ ] `annc_all` 테이블에 데이터 존재
- [ ] 최소 4-5개 이상의 공고 데이터 확인

**API 테스트 순서**:

1. **Django 서버 실행**
   ```bash
   cd zf_django
   conda activate zipfit_env  # 또는 zf2_back
   python manage.py runserver
   ```

2. **API 문서 접속**
   - `http://127.0.0.1:8000/api/docs`

3. **API 테스트 순서**:
   - [ ] `GET /api/annc_summary` - 공고 요약 정보
   - [ ] `GET /api/anncs` - 공고 목록 조회
   - [ ] `GET /api/chathistories` - 채팅 히스토리 목록
   - [ ] `POST /api/chat` - 채팅 메시지 전송

4. **응답 형식 확인 및 문서화**
   - 각 API의 실제 응답 형식 확인
   - `lab/ohj/api응답형식.md` 파일에 기록

---

## 4단계: 프론트엔드 개발

**API 테스트 완료 후**:
- 실제 응답 형식에 맞춰 프론트엔드 개발 진행
- 각 페이지별 API 연동

---

## ⚠️ 예상 오류 및 해결 방법

### 오류 1: 테이블이 존재하지 않음

**증상**:
```
relation "annc_all" does not exist
```

**해결 방법**:
```bash
cd zf_django
python manage.py migrate chatbot
```

### 오류 2: vector 확장이 없음

**증상**:
```
type "vector" does not exist
```

**해결 방법**:
```bash
# Docker 컨테이너 접속
docker exec -it zf_db_container psql -U zf_admin -d zf_db

# 확장 설치
CREATE EXTENSION IF NOT EXISTS vector;
```

### 오류 3: 환경 변수 로드 실패

**증상**:
```
KeyError: 'DB_HOST'
```

**해결 방법**:
- `.env` 파일 확인
- Root의 `.env` 파일 존재 확인
- 환경 변수 값 확인

---

## 📝 체크리스트

### 크롤링 실행 전
- [ ] Docker 컨테이너 실행 확인
- [ ] PostgreSQL 연결 확인
- [ ] Conda 가상환경 활성화
- [ ] 필요한 패키지 설치 확인

### 크롤링 실행
- [ ] 노트북 셀 순서대로 실행
- [ ] 오류 없이 완료 확인

### 데이터 확인
- [ ] `annc_all` 테이블에 데이터 존재 확인
- [ ] 최소 4-5개 이상의 공고 데이터 확인
- [ ] 공고 상태, 타입 확인

### API 테스트
- [ ] Django 서버 실행
- [ ] `/api/docs` 접속 확인
- [ ] 각 API 엔드포인트 테스트
- [ ] 응답 형식 확인 및 문서화

---

**작성일**: 2025-01-20  
**상태**: 크롤링 실행 및 데이터 확인 가이드 작성 완료

