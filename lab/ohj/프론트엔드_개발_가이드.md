# í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ê°€ì´ë“œ

> **ì‹¤ì œ API ì‘ë‹µ í˜•ì‹ ê¸°ë°˜ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ**

---

## âœ… í˜„ì¬ ìƒíƒœ

- **API ì‘ë‹µ í˜•ì‹ í™•ì¸ ì™„ë£Œ**: âœ…
- **Mock ë°ì´í„° ìƒì„± ì™„ë£Œ**: âœ…
- **ë‹¤ìŒ ë‹¨ê³„**: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ

---

## ğŸ“‹ ê°œë°œ ì „ëµ

### 1. Mock ë°ì´í„° ì‚¬ìš© (ê°œë°œ ì¤‘)

**ì´ìœ **:
- ì‹¤ì œ ë°ì´í„° ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
- ê°œë°œ ì¤‘ì—ëŠ” Mock ë°ì´í„°ë¡œ UI/UX ê²€ì¦
- ì‹¤ì œ API í˜•ì‹ì— ë§ì¶° ì‘ì„±ë˜ì–´ ë‚˜ì¤‘ì— êµì²´ ì‰¬ì›€

**êµ¬í˜„**:
- `figma_django/web/static/js/mockData.js` íŒŒì¼ ìƒì„±
- ì‹¤ì œ API ì‘ë‹µ í˜•ì‹ì— ë§ì¶° Mock ë°ì´í„° ì‘ì„±
- `USE_MOCK_DATA` í”Œë˜ê·¸ë¡œ Mock/ì‹¤ì œ API ì „í™˜

### 2. ë°ì´í„° ì €ì¥ ì „ëµ

**í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë°ì´í„° ì €ì¥ ë° ì‚¬ìš©**:
- API í˜¸ì¶œ ì‹œ ì‘ë‹µ ë°ì´í„°ë¥¼ ì €ì¥
- `sessionStorage` ë˜ëŠ” `localStorage` ì‚¬ìš©
- í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì €ì¥ëœ ë°ì´í„° ì‚¬ìš©

**ì¥ì **:
- ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ë°©ì§€
- ë¹ ë¥¸ í˜ì´ì§€ ë¡œë”©
- ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œë„ ì¼ë¶€ ë°ì´í„° í‘œì‹œ ê°€ëŠ¥

---

## ğŸ—‚ï¸ íŒŒì¼ êµ¬ì¡°

```
figma_django/web/static/js/
â”œâ”€â”€ api.js          # ì‹¤ì œ API í˜¸ì¶œ í•¨ìˆ˜
â”œâ”€â”€ mockData.js     # Mock ë°ì´í„° ë° Mock API í•¨ìˆ˜
â””â”€â”€ main.js         # ê° í˜ì´ì§€ë³„ JavaScript (ê¸°ì¡´)
```

---

## ğŸ“ ê°œë°œ ìˆœì„œ

### Phase 1: main.html - ê³µê³  ìš”ì•½ ì •ë³´ í‘œì‹œ

**ì‘ì—… ë‚´ìš©**:
1. í˜ì´ì§€ ë¡œë“œ ì‹œ `/api/annc_summary` í˜¸ì¶œ
2. ì‘ë‹µ ë°ì´í„°ë¥¼ `sessionStorage`ì— ì €ì¥
3. í†µê³„ ìˆ«ì ì—…ë°ì´íŠ¸:
   - "ë“±ë¡ëœ ê³µê³ ": `cnt_total`
   - "ì´ë²ˆ ì£¼ ì‹ ê·œ": (ì¶”ê°€ ê³„ì‚° í•„ìš” ë˜ëŠ” ë³„ë„ API)
   - "ëˆ„ì  ìƒë‹´": (ì¶”ê°€ ê³„ì‚° í•„ìš” ë˜ëŠ” ë³„ë„ API)

**êµ¬í˜„ ì˜ˆì‹œ**:
```javascript
// main.htmlì˜ <script> íƒœê·¸ ë‚´
document.addEventListener('DOMContentLoaded', async () => {
    // ì €ì¥ëœ ë°ì´í„° í™•ì¸
    const cachedData = sessionStorage.getItem('annc_summary');
    if (cachedData) {
        const data = JSON.parse(cachedData);
        updateAnncSummary(data);
    }
    
    // API í˜¸ì¶œ
    try {
        const response = await API.getAnnouncementSummary();
        if (response.status === 'success') {
            // ë°ì´í„° ì €ì¥
            sessionStorage.setItem('annc_summary', JSON.stringify(response.data));
            // í™”ë©´ ì—…ë°ì´íŠ¸
            updateAnncSummary(response.data);
        }
    } catch (error) {
        console.error('ê³µê³  ìš”ì•½ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
    }
});

function updateAnncSummary(data) {
    document.querySelector('#total-annc').textContent = data.cnt_total;
    document.querySelector('#lease-annc').textContent = data.cnt_lease;
    // ...
}
```

---

### Phase 2: list.html - ê³µê³  ëª©ë¡ í‘œì‹œ

**ì‘ì—… ë‚´ìš©**:
1. í˜ì´ì§€ ë¡œë“œ ì‹œ `/api/anncs` í˜¸ì¶œ
2. ì‘ë‹µ ë°ì´í„°ë¥¼ `sessionStorage`ì— ì €ì¥
3. ê³µê³  ì¹´ë“œ ëª©ë¡ ë Œë”ë§
4. í˜ì´ì§€ë„¤ì´ì…˜ ì²˜ë¦¬
5. í•„í„°ë§ ê¸°ëŠ¥ (ê²€ìƒ‰, ìƒíƒœ, íƒ€ì…)

**êµ¬í˜„ ì˜ˆì‹œ**:
```javascript
// list.htmlì˜ <script> íƒœê·¸ ë‚´
let currentPage = 1;
let currentFilters = {
    annc_status: 'ì „ì²´',
    annc_type: 'ì „ì²´',
    annc_title: ''
};

async function loadAnnouncements() {
    try {
        const response = await API.getAnnouncements({
            ...currentFilters,
            current_page: currentPage,
            items_per_page: 10
        });
        
        if (response.status === 'success') {
            // ë°ì´í„° ì €ì¥
            sessionStorage.setItem('annc_list', JSON.stringify(response.data));
            // í™”ë©´ ë Œë”ë§
            renderAnnouncements(response.data.items);
            renderPagination(response.data.page_info);
        }
    } catch (error) {
        console.error('ê³µê³  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:', error);
    }
}

function renderAnnouncements(items) {
    const container = document.querySelector('#annc-list');
    container.innerHTML = items.map(item => `
        <div class="annc-card">
            <h3>${item.annc_title}</h3>
            <p>ìƒíƒœ: ${item.annc_status}</p>
            <p>ìƒì„±ì¼: ${formatDate(item.created_dttm)}</p>
            <a href="${item.annc_url}" target="_blank">ìƒì„¸ë³´ê¸°</a>
        </div>
    `).join('');
}
```

---

### Phase 3: chat.html - ì±„íŒ… ê¸°ëŠ¥

**ì‘ì—… ë‚´ìš©**:
1. í˜ì´ì§€ ë¡œë“œ ì‹œ `/api/chathistories` í˜¸ì¶œ (íˆìŠ¤í† ë¦¬ ëª©ë¡)
2. ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ ì‹œ `/api/chat` í˜¸ì¶œ
3. ì‘ë‹µ ë°ì´í„°ë¥¼ `sessionStorage`ì— ì €ì¥
4. ì±„íŒ… ë©”ì‹œì§€ ë Œë”ë§

**êµ¬í˜„ ì˜ˆì‹œ**:
```javascript
// chat.htmlì˜ <script> íƒœê·¸ ë‚´
const userKey = getOrCreateUserKey();
let currentSessionKey = getCurrentSessionKey() || createSessionKey();

async function sendMessage(message) {
    try {
        const response = await API.sendChatMessage(message, userKey, currentSessionKey);
        if (response.status === 'success') {
            // ì±„íŒ… íˆìŠ¤í† ë¦¬ ì €ì¥
            const chatHistory = JSON.parse(sessionStorage.getItem('chat_history') || '[]');
            chatHistory.push({
                type: 'user',
                message: message
            });
            chatHistory.push({
                type: 'bot',
                message: response.data.ai_response.message
            });
            sessionStorage.setItem('chat_history', JSON.stringify(chatHistory));
            
            // í™”ë©´ ì—…ë°ì´íŠ¸
            renderChatMessage('user', message);
            renderChatMessage('bot', response.data.ai_response.message);
        }
    } catch (error) {
        console.error('ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:', error);
    }
}
```

---

### Phase 4: main.html - ì±„íŒ… íˆìŠ¤í† ë¦¬ ëª©ë¡

**ì‘ì—… ë‚´ìš©**:
1. í˜ì´ì§€ ë¡œë“œ ì‹œ `/api/chathistories` í˜¸ì¶œ
2. ì±„íŒ… íˆìŠ¤í† ë¦¬ ëª©ë¡ í‘œì‹œ
3. í´ë¦­ ì‹œ í•´ë‹¹ íˆìŠ¤í† ë¦¬ ìƒì„¸ ì¡°íšŒ

---

## ğŸ”„ Mock â†’ ì‹¤ì œ API ì „í™˜

**ì „í™˜ ë°©ë²•**:
1. `mockData.js` íŒŒì¼ì—ì„œ `USE_MOCK_DATA` í”Œë˜ê·¸ ë³€ê²½:
   ```javascript
   const USE_MOCK_DATA = false; // ì‹¤ì œ API ì‚¬ìš©
   ```

2. ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œ ì œì–´:
   ```javascript
   const USE_MOCK_DATA = window.location.hostname === 'localhost';
   ```

---

## ğŸ’¾ ë°ì´í„° ì €ì¥ ì „ëµ

### sessionStorage ì‚¬ìš© (ê¶Œì¥)

**ìš©ë„**: ì„¸ì…˜ ë™ì•ˆë§Œ ìœ ì§€ (íƒ­ ë‹«ìœ¼ë©´ ì‚­ì œ)

**ì‚¬ìš© ì˜ˆì‹œ**:
```javascript
// ë°ì´í„° ì €ì¥
sessionStorage.setItem('annc_summary', JSON.stringify(data));

// ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
const data = JSON.parse(sessionStorage.getItem('annc_summary') || '{}');

// ë°ì´í„° ì‚­ì œ
sessionStorage.removeItem('annc_summary');
```

**ì €ì¥í•  ë°ì´í„°**:
- `annc_summary`: ê³µê³  ìš”ì•½ ì •ë³´
- `annc_list`: ê³µê³  ëª©ë¡
- `chat_history`: í˜„ì¬ ì±„íŒ… íˆìŠ¤í† ë¦¬
- `chat_histories`: ì±„íŒ… íˆìŠ¤í† ë¦¬ ëª©ë¡

### localStorage ì‚¬ìš© (ì„ íƒì‚¬í•­)

**ìš©ë„**: ë¸Œë¼ìš°ì €ì— ì˜êµ¬ ì €ì¥

**ì‚¬ìš© ì˜ˆì‹œ**:
```javascript
localStorage.setItem('user_key', userKey);
const userKey = localStorage.getItem('user_key');
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œ ì¤€ë¹„
- [x] API ì‘ë‹µ í˜•ì‹ í™•ì¸ ì™„ë£Œ
- [x] Mock ë°ì´í„° ìƒì„± ì™„ë£Œ
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì‹œì‘

### main.html ê°œë°œ
- [ ] `/api/annc_summary` ì—°ë™
- [ ] ë°ì´í„° ì €ì¥ ë° í‘œì‹œ
- [ ] `/api/chathistories` ì—°ë™ (ì±„íŒ… íˆìŠ¤í† ë¦¬ ëª©ë¡)

### list.html ê°œë°œ
- [ ] `/api/anncs` ì—°ë™
- [ ] ê³µê³  ëª©ë¡ ë Œë”ë§
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„
- [ ] í•„í„°ë§ ê¸°ëŠ¥ êµ¬í˜„

### chat.html ê°œë°œ
- [ ] `/api/chat` ì—°ë™
- [ ] ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ ë° í‘œì‹œ
- [ ] `/api/chathistories/{session_key}` ì—°ë™ (ê¸°ì¡´ íˆìŠ¤í† ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°)

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **main.html ê°œë°œ ì‹œì‘**
   - Mock ë°ì´í„°ë¡œ UI ê²€ì¦
   - ì‹¤ì œ API ì—°ë™

2. **list.html ê°œë°œ**
   - ê³µê³  ëª©ë¡ í‘œì‹œ
   - í˜ì´ì§€ë„¤ì´ì…˜ ë° í•„í„°ë§

3. **chat.html ê°œë°œ**
   - ì±„íŒ… ê¸°ëŠ¥ êµ¬í˜„

---

**ì‘ì„±ì¼**: 2025-01-20  
**ìƒíƒœ**: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ê°€ì´ë“œ ì‘ì„± ì™„ë£Œ

