# 피드백 반영 수정 사항

## 수정된 문제

### 1. 공고 상태 표시 문제 ✅
**문제**: 실제 공고는 "공고중"인데 "공고예정"으로 표시됨

**원인**: 
- `createAnnouncementCard` 함수에서 `getCurrentStatus` 함수를 사용하지 않고 직접 날짜를 계산
- `annc_pblsh_dt`와 `annc_deadline_dt`를 사용하지 않고 `created_dttm`을 기반으로 계산

**해결**:
- `createAnnouncementCard` 함수에서 `getCurrentStatus(annc)` 함수를 사용하도록 수정
- `getCurrentStatus` 함수가 이미 `annc_pblsh_dt`와 `annc_deadline_dt`를 기반으로 정확한 상태를 계산하도록 구현됨

**변경 파일**:
- `zf_django/web/templates/web/list.html`: `createAnnouncementCard` 함수 수정

### 2. 필터 문제 ✅
**문제**: 
- 기관 필터가 작동하지 않음 (LH 선택해도 모든 공고가 보임)
- 상태 필터가 작동하지 않음 (공고중 필터 시 공고예정 카드가 보임)
- 유형 필터가 작동하지 않음 (영구임대주택, 행복주택 필터 시 공고가 없습니다)

**원인**: 
- `api.js`의 `getAnnouncements` 함수에서 `agency` 파라미터를 전달하지 않음
- 필터 파라미터가 제대로 전달되지 않음

**해결**:
- `api.js`의 `getAnnouncements` 함수에 `agency` 파라미터 추가
- `agency` 파라미터가 '전체'가 아닌 경우에만 쿼리 파라미터에 추가

**변경 파일**:
- `zf_django/web/static/js/api.js`: `getAnnouncements` 함수에 `agency` 파라미터 추가

### 3. 사용자 ID 문제 ✅
**문제**: user-info 페이지에서 부여하는 사용자 자동 ID가 바뀌지 않음

**원인**: 
- `getOrCreateUserKey()` 함수가 localStorage에서 기존 값을 가져오기 때문에 한 번 생성되면 계속 같은 값이 사용됨
- `?reset=1` 파라미터로 초기화해도 user_key는 초기화되지 않음

**해결**:
- `user_info.html`에서 `?reset=1` 파라미터가 있을 때 `localStorage.removeItem('user_key')`로 기존 user_key 제거
- 새 user_key 생성 후 localStorage에 저장

**변경 파일**:
- `zf_django/web/templates/web/user_info.html`: user_key 초기화 로직 추가

## 추가 확인 필요 사항

### 날짜 형식 확인
사용자 피드백에 따르면:
- 실제 공고일: 2025.05.28
- 실제 접수기간: 2025.06.19 ~ 2025.12.31
- 우리 웹페이지: 2025.05.28 ~ 2025.12.31 (모집 기간) -> 이 방식이 문제가 없다면 이렇게 진행해도 문제 없음, 그러나 만약 날짜가 2025.06.19일이 되면 '태그'가 '공고중'에서 '접수중'으로 바뀌어야한다.

**확인 필요**: -> DB 필드 실제 형식 어떻게 확인해야하는지 알려주거나 너가 확인해보면 좋겠다.
- DB의 `annc_pblsh_dt`와 `annc_deadline_dt` 필드의 실제 형식
- `annc_pblsh_dt`가 "공고일"인지 "접수 시작일"인지 확인
- `annc_deadline_dt`가 "접수 종료일"인지 확인

### 필터 값 매칭 확인
**확인 필요**: -> DB 필드 실제 형식 어떻게 확인해야하는지 알려주거나 너가 확인해보면 좋겠다.
- DB의 `annc_status` 값이 프론트엔드 필터 값("공고중", "접수중", "마감", "공고예정")과 일치하는지 확인
- DB의 `annc_type` 값이 프론트엔드 필터 값("영구임대주택", "행복주택" 등)과 일치하는지 확인
- DB의 `annc_url`에서 기관을 추출하는 로직이 올바른지 확인

## 테스트 체크리스트

- [check] 공고 상태가 올바르게 표시되는지 확인 (공고중이 공고중으로 표시되는지)
    - [정정공고]양주회천 A25BL 영구임대주택 입주자 모집공고
        - '공고중'(실제) = '공고중'(웹)
    - 양주시, 동두천시 행복주택 상시모집[선착순동호지정, 입주자격완화, 선계약후검증]
        - '접수중'(실제) != '공고중'(웹)
            근거-> 접수기간 : 2025.06.19 ~ 2025.12.31

-> 근데 웹상에서 공고상태는 둘다 '공고중'으로 나온다. 그렇지만 내 생각은 '양주시, 동두천시...'공고는
공고중이라고 하는 것도 맞는 것 같지만, 실제 접수 기간에 해당하니깐, 접수중이라고 해야하는 것이 아닌가?

- [x] 모집 기간이 올바르게 표시되는지 확인
    - 접수 기간이 모집 기간으로 봐야하지 않나?
    - 지금은 어떻게 계산해서 모집 기간을 설정하는지 잘 모르겠다.
    - 만약 '공고등록일'-'접수마감' 을 기준으로 했다면, '양주시, 동두천시...' 공고는 올바르게 되었지만,
      '양주회천 A25BL 영구임대주택...'공고는 공고등록일이 2025.11.27 이다.
      그리고 접수기간 : 2025.12.15 ~ 2025.12.19 으로 명시되어있다. -> 웹상

- [o] D-day가 올바르게 계산되어 표시되는지 확인
    - 현재 공고에 표기된 모집기간을 기준이라고 하면 문제 없음, 단 모집기간이 올바른 경우.
- [o] 기관 필터가 정상 작동하는지 확인 (LH 선택 시 LH 공고만 표시)
- [o] 상태 필터가 정상 작동하는지 확인 (공고중 선택 시 공고중 공고만 표시)
- [x] 유형 필터가 정상 작동하는지 확인 (영구임대주택 선택 시 영구임대주택 공고만 표시)
    - 우선 문제는 두개의 공고가 각각 '임대'라고 태그가 바뀌었다.
    - 그래서 그런지 필터 올바르지 않음.
    - 지금 태그 '임대' x '영구임대주택' o '행복주택' o
    - 태그 값 부터 수정이 되어야 필터링을 확인 할 수 있을 것 같음. 

- [o] user-info 페이지에서 `?reset=1` 파라미터로 접속 시 새로운 user_key가 생성되는지 확인

## 추가로 이야기하는 부분.
- 백앤드 담당하는 팀원이 지금 crawler 와 청킹 등 일부 내용을 수정해서 깃 커밋, 푸쉬를 해서 올려둔 상황
- 위 데이터를 받으면 현재 우리가 조금씩 건든 config view, url 등 바꾼 부분이라던지 api 주소 넣고 수정한 부분들이 아마도 팀원껀 수정이 안되어있을 수도 있다.
- 그리고 팀원 이야기로는 위 깃헙 최신 코드를 받으면 크롤링해서 실제 데이터 30개 정도를 더 받을 수 있다고함.
- zf_crawler/크롤링.ipynb 를 그래서 업데이트해서 실행하는 과정을 너가 가이드해줘야한다.
- 마찬가지로 어떤 부분이 현재 지금 부분에서 바뀐건지 파악해야함. 그래서 내가 필요한 부분은 팀원꺼에서 업데이트를 해야함. 맞지?
- 이 부분에 대한 이슈 해결 방법이나 등에 대해서 생각해야함. 전문적인 소견과 재귀적인 검토를 통해서 최선의 방법을 제공해야함.

## 이런 부분은 어떻게 해야하는지 모름. 가이드해줘야함.
DB의 annc_pblsh_dt가 "공고일"인지 "접수 시작일"인지 확인
annc_deadline_dt가 "접수 종료일"인지 확인
DB의 실제 날짜 형식 확인
필터 값 매칭 확인
DB의 annc_status 값이 프론트엔드 필터 값("공고중", "접수중", "마감", "공고예정")과 일치하는지 확인
DB의 annc_type 값이 프론트엔드 필터 값("영구임대주택", "행복주택" 등)과 일치하는지 확인
테스트 후 결과를 알려주세요. 추가 문제가 있으면 알려주세요.