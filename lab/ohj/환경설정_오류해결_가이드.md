# í™˜ê²½ ì„¤ì • ì˜¤ë¥˜ í•´ê²° ê°€ì´ë“œ

> **Docker, PostgreSQL ì„¤ì • ì‹œ ë°œìƒí•œ ì˜¤ë¥˜ ë° í•´ê²° ë°©ë²•**

---

## ğŸ“‹ ì°¸ê³  ë¬¸ì„œ

- `zf_django/í™˜ê²½ì„¤ì •_zf_django.md` - ê¸°ë³¸ í™˜ê²½ ì„¤ì • ê°€ì´ë“œ

---

## ğŸ” ì˜¤ë¥˜ ìœ í˜•ë³„ í•´ê²° ë°©ë²•

### ì˜¤ë¥˜ 1: PostgreSQL vector í™•ì¥ ì—†ìŒ

**ì¦ìƒ**:
```
psycopg2.errors.UndefinedObject: type "vector" does not exist
LINE 1: ...T NULL, "page_num" smallint NOT NULL, "embedding" vector(153...
```

**ì›ì¸**: PostgreSQLì— pgvector í™•ì¥ì´ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:
```bash
# Docker ì»¨í…Œì´ë„ˆ ì ‘ì†
docker exec -it zf_db_container psql -U zf_admin -d zf_db

# í™•ì¥ ì„¤ì¹˜
CREATE EXTENSION IF NOT EXISTS vector;

# ì„¤ì¹˜ í™•ì¸
\dx vector
```

**í™•ì¸ ë°©ë²•**:
```sql
-- í™•ì¥ ëª©ë¡ í™•ì¸
SELECT * FROM pg_extension WHERE extname = 'vector';
```

---

### ì˜¤ë¥˜ 2: fts_vector ì»¬ëŸ¼ ì—†ìŒ

**ì¦ìƒ**:
```
psycopg2.errors.UndefinedColumn: column "fts_vector" does not exist
```

**ì›ì¸**: ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì—ì„œ ì»¬ëŸ¼ ì¶”ê°€ê°€ ì£¼ì„ ì²˜ë¦¬ë˜ì–´ ìˆìŒ

**í•´ê²° ë°©ë²•**:

1. **ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìˆ˜ì •**
   ```bash
   # íŒŒì¼ ìœ„ì¹˜
   zf_django/chatbot/migrations/0006_add_docchunks_fts_vector_trigger.py
   ```

2. **ì£¼ì„ í•´ì œ**
   ```python
   # ì£¼ì„ í•´ì œ ì „
   --ALTER TABLE doc_chunks
   --ADD COLUMN IF NOT EXISTS fts_vector tsvector;
   
   # ì£¼ì„ í•´ì œ í›„
   ALTER TABLE doc_chunks
   ADD COLUMN IF NOT EXISTS fts_vector tsvector;
   ```

3. **ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰**
   ```bash
   cd zf_django
   python manage.py migrate chatbot
   ```

4. **ë‹¤ì‹œ ì£¼ì„ ì²˜ë¦¬**
   - ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì—ì„œ ë‹¤ì‹œ ì£¼ì„ ì²˜ë¦¬

5. **Fake ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©**
   ```bash
   python manage.py migrate chatbot 0007_docchunks_fts_vector --fake
   python manage.py migrate chatbot
   ```

---

### ì˜¤ë¥˜ 3: Docker ì»¨í…Œì´ë„ˆ ì—°ê²° ì‹¤íŒ¨

**ì¦ìƒ**:
```
could not connect to server: Connection refused
Is the server running on host "localhost" and accepting TCP/IP connections on port 5432?
```

**ì›ì¸**: Docker ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:

1. **ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸**
   ```bash
   docker ps -a
   ```

2. **ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë©´ ìƒì„±**
   ```bash
   docker run -d `
   -e POSTGRES_USER=zf_admin `
   -e POSTGRES_PASSWORD=zf_pwd1 `
   -e POSTGRES_DB=zf_db `
   --name zf_db_container `
   -p 5432:5432 `
   pgvector/pgvector:pg17
   ```

3. **ì»¨í…Œì´ë„ˆê°€ ì¤‘ì§€ë˜ì–´ ìˆìœ¼ë©´ ì‹œì‘**
   ```bash
   docker start zf_db_container
   ```

4. **ì—°ê²° í™•ì¸**
   ```bash
   docker exec -it zf_db_container psql -U zf_admin -d zf_db
   ```

---

### ì˜¤ë¥˜ 4: í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ ì‹¤íŒ¨

**ì¦ìƒ**:
```
KeyError: 'DJANGO_SECRET_KEY'
ë˜ëŠ”
KeyError: 'DB_HOST'
```

**ì›ì¸**: `.env` íŒŒì¼ì´ ì—†ê±°ë‚˜ í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:

1. **Rootì˜ `.env` íŒŒì¼ í™•ì¸**
   ```bash
   # íŒŒì¼ ìœ„ì¹˜ í™•ì¸
   C:\SKN_19\ZIP-FIT-2\.env
   ```

2. **í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ í™•ì¸**
   ```env
   # Django Secret Key
   DJANGO_SECRET_KEY=django-insecure-0#z1rbplff)#c)84_zcg^5ex#p(j)ibh*g%%_dfpai(s9@^tf@
   
   # PostgreSQL Database ì„¤ì •
   DB_HOST=localhost
   DB_PORT=5432
   DB_USER=zf_admin
   DB_PASSWORD=zf_pwd1
   DB_NAME=zf_db
   ```

3. **í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ í™•ì¸**
   ```python
   # Pythonì—ì„œ í™•ì¸
   from decouple import config
   print(config('DB_HOST'))
   ```

---

### ì˜¤ë¥˜ 5: ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨

**ì¦ìƒ**:
```
django.db.utils.OperationalError: ...
```

**ì›ì¸**: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì™€ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ë¶ˆì¼ì¹˜

**í•´ê²° ë°©ë²•**:

1. **ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸**
   ```bash
   cd zf_django
   python manage.py showmigrations chatbot
   ```

2. **ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±**
   ```bash
   python manage.py makemigrations chatbot
   ```

3. **ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰**
   ```bash
   python manage.py migrate chatbot
   ```

4. **íŠ¹ì • ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ ë¡¤ë°± (í•„ìš”ì‹œ)**
   ```bash
   python manage.py migrate chatbot 0005  # íŠ¹ì • ë§ˆì´ê·¸ë ˆì´ì…˜ ë²ˆí˜¸
   ```

---

### ì˜¤ë¥˜ 6: íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì‹¤íŒ¨

**ì¦ìƒ**:
```
ModuleNotFoundError: No module named 'django'
ë˜ëŠ”
ModuleNotFoundError: No module named 'psycopg2'
```

**ì›ì¸**: ê°€ìƒí™˜ê²½ì´ í™œì„±í™”ë˜ì§€ ì•Šì•˜ê±°ë‚˜ íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:

1. **Conda ê°€ìƒí™˜ê²½ í™œì„±í™”**
   ```bash
   conda activate zipfit_env  # ë˜ëŠ” zf2_back
   ```

2. **í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜**
   ```bash
   pip install -r requirements.txt
   ```

3. **ê°œë³„ íŒ¨í‚¤ì§€ ì„¤ì¹˜**
   ```bash
   pip install django
   pip install psycopg2-binary
   pip install python-decouple
   pip install pgvector
   pip install djangorestframework
   pip install drf-spectacular
   ```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### í™˜ê²½ ì„¤ì • ì™„ë£Œ í™•ì¸
- [ ] Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì¤‘
- [ ] PostgreSQL ì—°ê²° ê°€ëŠ¥
- [ ] vector í™•ì¥ ì„¤ì¹˜ ì™„ë£Œ
- [ ] `.env` íŒŒì¼ ì¡´ì¬ ë° í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ
- [ ] Conda ê°€ìƒí™˜ê²½ í™œì„±í™”
- [ ] í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ

### ì˜¤ë¥˜ ë°œìƒ ì‹œ í™•ì¸ ì‚¬í•­
- [ ] ì˜¤ë¥˜ ë©”ì‹œì§€ ì „ì²´ í™•ì¸
- [ ] ê´€ë ¨ ë¡œê·¸ í™•ì¸
- [ ] í™˜ê²½ ì„¤ì • ìƒíƒœ í™•ì¸
- [ ] ì°¸ê³  ë¬¸ì„œ í™•ì¸ (`zf_django/í™˜ê²½ì„¤ì •_zf_django.md`)

---

## ğŸ’¡ íŒ

### 1. ë‹¨ê³„ë³„ í™•ì¸
- ê° ë‹¨ê³„ë§ˆë‹¤ í™•ì¸ í›„ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰
- ì˜¤ë¥˜ ë°œìƒ ì‹œ ì¦‰ì‹œ í•´ê²°

### 2. ë¡œê·¸ í™•ì¸
- Docker ë¡œê·¸: `docker logs zf_db_container`
- Django ë¡œê·¸: ì½˜ì†” ì¶œë ¥ í™•ì¸

### 3. ë°±ì—… ë° ë³µêµ¬
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ ë°±ì—… ê¶Œì¥
- ë¬¸ì œ ë°œìƒ ì‹œ Docker ì»¨í…Œì´ë„ˆ ì¬ìƒì„± ê°€ëŠ¥

---

**ì‘ì„±ì¼**: 2025-01-20  
**ìƒíƒœ**: í™˜ê²½ ì„¤ì • ì˜¤ë¥˜ í•´ê²° ê°€ì´ë“œ ì‘ì„± ì™„ë£Œ  
**ì°¸ê³ **: `zf_django/í™˜ê²½ì„¤ì •_zf_django.md`

